<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub JSON Speichern</title>
</head>
<body>
    <h1>Team-Umfrage 2025</h1>
    <form id="survey-form">
        <label for="personalGoals">Persönliche Ziele:</label>
        <input type="text" id="personalGoals" name="personalGoals" required><br><br>

        <label for="feedback">Feedback:</label>
        <textarea id="feedback" name="feedback" required></textarea><br><br>

        <button type="submit">Absenden</button>
    </form>

    <script>
        document.getElementById("survey-form").addEventListener("submit", async function(e) {
            e.preventDefault();

            const url = "https://api.github.com/repos/<USER>/<REPO>/contents/data.json"; // REPO ersetzen
            const token = "dein-github-access-token"; // Hier dein Token einfügen

            const formData = {
                personalGoals: document.getElementById("personalGoals").value,
                feedback: document.getElementById("feedback").value,
            };

            const response = await fetch(url, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Accept": "application/vnd.github+json",
                },
            });

            const currentContent = response.ok
                ? atob((await response.json()).content)
                : "[]";

            const updatedContent = JSON.stringify([...JSON.parse(currentContent), formData], null, 2);

            const encodedContent = btoa(updatedContent);

            await fetch(url, {
                method: "PUT",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Accept": "application/vnd.github+json",
                },
                body: JSON.stringify({
                    message: "Update data.json",
                    content: encodedContent,
                    sha: response.ok ? (await response.json()).sha : undefined,
                }),
            });

            alert("Daten erfolgreich gespeichert!");
        });
    </script>
</body>
</html>